<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>个人资金账户</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <style>
		.top_box {
			overflow: hidden;
		}
		.top_box li {
			width: 45%;
			height: 2rem;
			line-height: 2rem;
			text-align: center;
		}
		.top_box li .this_active {
			padding-left: 0.5rem;
			padding-right: 0.5rem;
			color: #ffc107;
			border-bottom: 0.1rem solid #ffc107;
		}
		.top_box li span {
			height: 100%;
			overflow: hidden;
		}
		.filter_box {
			margin-top: 0.4rem;
			color: gray;
			overflow: hidden;
		}
		.filter_box div:nth-child(1) {
			width: 30%;
			height: 1rem;
			line-height: 1rem;
			text-align: center;
		}
		.filter_box div:nth-child(2) {
			width: 40%;
			height: 1rem;
			line-height: 1rem;
			text-align: center;
		}
		.filter_box div:nth-child(3) {
			width: 30%;
			height: 1rem;
			line-height: 1rem;
			text-align: center;
		}
		.main_top {
			overflow: hidden;
			height: 1.7rem;
			line-height: 1.7rem;
			color: gray;
			background-color: #dcdcdc;
			margin-top: 0.5rem;
		}
		.main_top li {
			width: 20%;
			text-align: center;
		}
		.main_top .li_shou {
			width: 20%;
		}
		.main_box {
			overflow: hidden;
		}
		.main_ul {
			overflow: hidden;
		}
		.main_box .main_ul li {
			width: 20%;
			height: 2.2rem;
			line-height: 2.2rem;
			color: #ffc107;
			text-align: center;
		}
		.main_box .main_ul .li_shou {
			width: 20%;
		}
		.main_box .main_ul li img {
			width: 1.2rem;
			margin: auto;
			vertical-align: middle;
			margin-top: 0.4rem;
		}
		.btn_box {
			width: 60%;
			background-color: #ffc107;
			margin: 0 auto;
			text-align: center;
			color: #fff;
			padding: 0.35rem 0rem;
			border-radius: 2rem;
			position: fixed;
			left: 20%;
			bottom:10%;
		}
		.isshow {
			display: none;
		}
		.type_maxbox {
			position: relative;
		}
		.type_box {
			position: absolute;
			top: 2.5rem;
			width: 100%;
			background-color: #fff;
			z-index: 1000;
		}
		.type_box li {
			width: 100%;
			height: 1.6rem;
			line-height: 1.6rem;
			padding-left: 0.5rem;
		}
		.isshow {
			display: none;
		}
		.shade_box {
			position: absolute;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			background: #000;
			opacity: 0.4;
			z-index: 888;
		}
		.btn_box2 {
			width: 84%;
			overflow: hidden;
			position: fixed;
			left: 8%;
			bottom:10%;
		}
		.btn_box2 div:nth-child(1) {
			color: #ffb51e;
			height: 1.8rem;
			line-height: 1.8rem;
			text-align: center;
			width: 45%;
			border-radius: 1.2rem;
			border: 1px solid #ffb51e;
		}
		.btn_box2 div:nth-child(2) {
			color: #fff;
			background-color: #ffb51e;
			height: 1.8rem;
			line-height: 1.8rem;
			text-align: center;
			width: 45%;
			border-radius: 1.2rem;
			border-color:#ffb51e;
		}
        .main_box {
           display:none;
       }
       /*.main_box1 {
           display: block;
       }*/
    </style>
</head>
<body>

<ul class="top_box aui-font-size-14 aui-border-b">
	<li class="aui-pull-left" value="6001">
		<span class="this_active">Prepayment Account</span>
	</li>
	<li class="aui-pull-right" value="6002">
		<span>Cloud Union Account</span>
	</li>
</ul>

<div class="filter_box aui-font-size-14">
	<div class="aui-pull-left aui-border-r" onclick="type_filter()">
		<span class="aui-padded-r-5 type_text">all</span>
		<i class="aui-iconfont aui-icon-down"></i>
	</div>
	<div class="aui-pull-left aui-border-r" id="demo1">
		<span class="aui-padded-r-5 month_text">Month</span>
		<i class="aui-iconfont aui-icon-down"></i>
	</div>
	<div class="aui-pull-left" id="demo2">
		<span class="aui-padded-r-5 date_text">Date</span>
		<i class="aui-iconfont aui-icon-down"></i>
	</div>
</div>

<div class="shade_box isshow"></div>

<div class="type_maxbox isshow">
	<ul class="type_box aui-font-size-14">
		<li class="aui-border-b">all</li>
		<li class="aui-border-b">admin top to</li>
		<li class="aui-border-b">top to</li>
		<li class="aui-border-b">upgrade</li>
		<li class="aui-border-b">withdrawal</li>
		<li class="aui-border-b">withdrawal rejected</li>
	</ul>
</div>

<ul class="main_top aui-font-size-12">
	<li class="aui-pull-left">Time</li>
	<li class="aui-pull-left">Type</li>
	<li class="aui-pull-left li_shou">Receipts & Payment</li>
	<li class="aui-pull-left">Status</li>
	<li class="aui-pull-left">Balance</li>
</ul>

<div class="main_box main_box1 aui-font-size-14">

</div>

<div class="main_box main_box2 aui-font-size-14">

</div>

</body>
<script type="text/javascript" src="../script/apiURL.js"></script>

<script type="text/javascript" src="../script/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/moment.min.js"></script>

<script>
var main_box = 'main_box1';
apiready = function() {
	var pagetype = api.pageParam.pagetype;
	$('.top_box li span').removeClass('this_active');
	$('.top_box li').each(function(index, el) {
		var tabval = $(this).attr('value');
		if (tabval == pagetype) {
			$(this).find('span').addClass('this_active');
			if (tabval == 6001) {
                $('.main_box1').show();
				$('.btn_box').removeClass('isshow');
				$('.btn_box2').addClass('isshow');
				$('.type_box').html('<li class="aui-border-b">All</li><li class="aui-border-b">admin top to</li><li class="aui-border-b">top to</li><li class="aui-border-b">upgrade</li><li class="aui-border-b">withdrawal</li><li class="aui-border-b">withdrawal rejected</li>');
			} else {
                $('.main_box2').show();
				$('.btn_box').addClass('isshow');
				$('.btn_box2').removeClass('isshow');
				$('.type_box').html('<li class="aui-border-b">All</li><li class="aui-border-b">admin top to</li><li class="aui-border-b">top to</li><li class="aui-border-b">upgrade</li><li class="aui-border-b">withdrawal</li><li class="aui-border-b">withdrawal rejected</li>');
			}
		}
	});
    var storage= window.localStorage;
    if (!storage) {
        api.alert('请升级APP');
        return false;
    }
    token = storage.getItem('ylh_authorization_token');
    id = storage.getItem('ylh_authorization_id');
    username = storage.getItem('ylh_authorization_username');

    apiurl=api_au;
    mrmon();

  $('body').on('click', '.top_box li', function(event) {
  	$('.top_box li span').removeClass('this_active');
  	$(this).find('span').addClass('this_active');
  	var tab_value = $(this).attr('value');
      $('.main_box').hide();
      var monstr='Month';
      if(montime.length>0){
        monstr=montime;
      }
      var monstr='Month';
      if(montime.length>0){
        monstr=montime;
      }
  	if (tab_value == 6001) {
  		$('.btn_box').removeClass('isshow');
  		$('.btn_box2').addClass('isshow');
  		$('.type_box').html('<li class="aui-border-b">All</li><li class="aui-border-b">admin top to</li><li class="aui-border-b">top to</li><li class="aui-border-b">upgrade</li><li class="aui-border-b">withdrawal</li><li class="aui-border-b">withdrawal rejected</li>');
  		$('.type_text').text('All');
  		$('.month_text').text(monstr);
  		$('.date_text').text('Date');
          main_box = 'main_box1';
          $('.' + main_box).show();
  	} else {
  		$('.btn_box').addClass('isshow');
  		$('.btn_box2').removeClass('isshow');
  		$('.type_box').html('<li class="aui-border-b">All</li><li class="aui-border-b">admin top up</li><li class="aui-border-b">checkout</li>');
  		$('.type_text').text('All');
  		$('.month_text').text(monstr);
  		$('.date_text').text('Date');
          main_box = 'main_box2';
          $('.' + main_box).show();
  	}
    mrmon();
  });

}
  var montime='';
  var daytime='';
  //默认月份
  function mrmon(){
    var nowdate = new Date();
    var seperator1 = "-";
    var nowyear = nowdate.getFullYear();
    var nowmon = nowdate.getMonth() + 1;
    var nowDay = nowdate.getDate();
    if (nowmon >= 1 && nowmon <= 9) {
        nowmon = "0" + nowmon;
    }
    if (nowDay >= 0 && nowDay <= 9) {
        nowDay = "0" + nowDay;
    }
    var nowstr = nowyear + seperator1 + nowmon;
    $('.month_text').text(nowstr);
    montime=nowstr;
    daytime='';
    $('.main_box1').html('');
    $('.main_box2').html('');
    creadall();
  }
  function creadall() {
    api.ajax({
        url: apiurl + 'transaction/get',
        method: 'get',
        headers: {
            'Content-Type': 'application/json;charset=utf-8',
            'authorization': 'Bearer ' + token
        },
        returnAll: true,
        data: {
            body: {
              "memberId": id
            }
        }
    }, function(ret, err) {
        if (ret) {
            var str = '';
            var tmpval = '';
            for (var i in ret.body.transactions) {
                let monindex=moment(ret.body.transactions[i].createdDate.slice(0,-6)).format('YYYY-MM');
                let dayindex=moment(ret.body.transactions[i].createdDate.slice(0,-6)).format('YYYY-MM-DD');
                if (ret.body.transactions[i].transactionType == 'KP_TO_CA') {
                    tmpval = ret.body.transactions[i].accountInAmount - ret.body.transactions[i].serviceCharge;
                } else if(ret.body.transactions[i].transactionType == 'CA_TO_TP' || ret.body.transactions[i].transactionType == 'PA_TO_TP') {
                    tmpval = ret.body.transactions[i].accountOutAmount;
                } else {
                    tmpval = ret.body.transactions[i].accountInAmount;
                }
                if (ret.body.transactions[i].transactionType == 'KP_TO_CA') {
                    tmpbalance = ret.body.transactions[i].accountInBalanceAfter;
                } else {
                    tmpbalance = ret.body.transactions[i].accountOutBalanceAfter;
                }
                str = '<ul class="main_ul aui-border-b">' +
                    '<li class="aui-pull-left">' + moment(ret.body.transactions[i].createdDate.slice(0,-6)).format('YYYY-MM-DD') + '</li>' +
                    '<li class="aui-pull-left" style="overflow:hidden;"><span>' + ret.body.transactions[i].transactionType + '</span></li>' +
                    '<li class="aui-pull-left li_shou">' +
                        '<span>' + tmpval.toFixed(2) + '</span>' +
                    '</li>' +
                    '<li class="aui-pull-left" style="overflow:hidden;"><span>' + ret.body.transactions[i].transactionStatus + '</span></li>' +
                    '<li class="aui-pull-left">' + tmpbalance.toFixed(2) + '</li>' +
                '</ul>';
                if (ret.body.transactions[i].transactionType == 'PA_TO_TP') {
                    // $('.main_box1').append(str);
                      if(daytime.length>1){
                        if(daytime==dayindex){
                          $('.main_box1').append(str);
                        }
                      }else if(montime.length>1){
                        if(montime==monindex){
                          $('.main_box1').append(str);
                        }
                      }else {
                        $('.main_box1').append(str);

                      }
                } else if (ret.body.transactions[i].transactionType == 'CA_TO_PA' || ret.body.transactions[i].transactionType == 'KP_TO_CA' || ret.body.transactions[i].transactionType == 'CA_TO_TP') {
                    // $('.main_box2').append(str);
                      if(daytime.length>1){
                        if(daytime==dayindex){
                          $('.main_box2').append(str);
                        }
                      }else if(montime.length>1){
                        if(montime==monindex){
                          $('.main_box2').append(str);
                        }
                      }else {
                        $('.main_box2').append(str);

                      }
                }
            }
            // $('.main_box').html(str);
        } else {
            api.toast({
                msg: err.body.message,
                duration: 2500,
                location: 'middle'
            });
        }
    });

    api.ajax({
        url: apiurl + 'payment/get',
        method: 'post',
        headers: {
            'Content-Type': 'application/json;charset=utf-8',
            'authorization': 'Bearer ' + token
        },
        returnAll: true,
        data: {
            body: {
              "memberId": id,
              "paymentType": "PA_TOP_UP"
            }
        }
    }, function(ret, err) {
        if (ret) {
            var str = '';
            for (var i in ret.body.payments) {
                let monindex=moment(ret.body.payments[i].createdDate).format('YYYY-MM');
                let dayindex=moment(ret.body.payments[i].createdDate).format('YYYY-MM-DD');
                str = '<ul class="main_ul aui-border-b">' +
                    '<li class="aui-pull-left">' + moment(ret.body.payments[i].createdDate).format('YYYY-MM-DD') + '</li>' +
                    '<li class="aui-pull-left" style="overflow:hidden;"><span>' + ret.body.payments[i].paymentType + '</span></li>' +
                    '<li class="aui-pull-left li_shou">' +
                        '<span>' + ret.body.payments[i].accountInAmount + '</span>' +
                    '</li>' +
                    '<li class="aui-pull-left" style="overflow:hidden;"><span>' + ret.body.payments[i].paymentStatus + '</span></li>' +
                    '<li class="aui-pull-left"> - </li>' +
                '</ul>';
                if (ret.body.payments[i].paymentType == 'PA_TO_TP' || ret.body.payments[i].paymentType == 'PA_TOP_UP' ) {
                    // $('.main_box1').append(str);
                      if(daytime.length>1){
                        if(daytime==dayindex){
                          $('.main_box1').append(str);
                        }
                      }else if(montime.length>1){
                        if(montime==monindex){
                          $('.main_box1').append(str);
                        }
                      }else {
                        $('.main_box1').append(str);

                      }
                } else if (ret.body.payments[i].paymentType == 'CA_TO_PA' || ret.body.payments[i].paymentType == 'KP_TO_CA' || ret.body.payments[i].paymentType == 'CA_TO_TP') {
                    // $('.main_box2').append(str);
                      if(daytime.length>1){
                        if(daytime==dayindex){
                          $('.main_box2').append(str);
                        }
                      }else if(montime.length>1){
                        if(montime==monindex){
                          $('.main_box2').append(str);
                        }
                      }else {
                        $('.main_box2').append(str);

                      }
                }
            }
            // $('.main_box').html(str);
        } else {
            api.toast({
                msg: err.body.message,
                duration: 2500,
                location: 'middle'
            });
        }
    });

    api.ajax({
        url: apiurl + 'payment/get',
        method: 'post',
        headers: {
            'Content-Type': 'application/json;charset=utf-8',
            'authorization': 'Bearer ' + token
        },
        returnAll: true,
        data: {
            body: {
              "memberId": id,
              "paymentType": "CA_REDEEM"
            }
        }
    }, function(ret, err) {
        if (ret) {
            var str = '';
            for (var i in ret.body.payments) {
                let monindex=moment(ret.body.payments[i].createdDate).format('YYYY-MM');
                let dayindex=moment(ret.body.payments[i].createdDate).format('YYYY-MM-DD');
                str = '<ul class="main_ul aui-border-b">' +
                    '<li class="aui-pull-left">' + moment(ret.body.payments[i].createdDate).format('YYYY-MM-DD') + '</li>' +
                    '<li class="aui-pull-left" style="overflow:hidden;"><span>' + ret.body.payments[i].paymentType + '</span></li>' +
                    '<li class="aui-pull-left li_shou">' +
                        '<span>' + ret.body.payments[i].accountInAmount + '</span>' +
                    '</li>' +
                    '<li class="aui-pull-left" style="overflow:hidden;"><span>' + ret.body.payments[i].paymentStatus + '</span></li>' +
                    '<li class="aui-pull-left"> - </li>' +
                '</ul>';
                // $('.main_box2').append(str);
                  if(daytime.length>1){
                    if(daytime==dayindex){
                      $('.main_box2').append(str);
                    }
                  }else if(montime.length>1){
                    if(montime==monindex){
                      $('.main_box2').append(str);
                    }
                  }else {
                    $('.main_box2').append(str);

                  }
            }
            // $('.main_box').html(str);
        } else {
            api.toast({
                msg: err.body.message,
                duration: 2500,
                location: 'middle'
            });
        }
    });
  }

function go_url(typenub) {
	var jsfun = 'go_url('+typenub+');';
	api.execScript({
	    script: jsfun
	});
}
$('body').on('click', '.type_box li', function(event) {
	$('.type_maxbox').toggle('isshow');
	$('.shade_box').toggle('isshow');
	$('.type_text').text($(this).text());
});

function type_filter() {
	$('.type_maxbox').toggle('isshow');
	$('.shade_box').toggle('isshow');
}

$('.shade_box').click(function(event) {
	$('.shade_box').toggle('isshow');
	$('.date_maxbox').toggle('isshow');
	$('.type_maxbox').toggle('isshow');
});


</script>

<script type="text/javascript" src="../plugin/datePicker/datePicker.js"></script>
<script type="text/javascript">

var calendar = new datePicker();

// 年月
calendar.init({
	'trigger': '#demo1', /*按钮选择器，用于触发弹出插件*/
	'type': 'ym',/*模式：date日期；datetime日期时间；time时间；ym年月；*/
	'minDate':'1980-1-1',/*最小日期*/
	'maxDate':'2030-12-31',/*最大日期*/
	'onSubmit':function(){/*确认时触发事件*/
		var theSelectData=calendar.value;
		$('.month_text').text(theSelectData);
		$('.date_text').text('Date');
    montime=theSelectData;
    daytime='';
    $('.main_box1').html('');
    $('.main_box2').html('');
    creadall();
	},
	'onClose':function(){/*取消时触发事件*/
	}
});

</script>

<script type="text/javascript">

var calendar2 = new datePicker();

// 年月日
calendar2.init({
	'trigger': '#demo2', /*按钮选择器，用于触发弹出插件*/
	'type': 'date',/*模式：date日期；datetime日期时间；time时间；ym年月；*/
	'minDate':'1980-1-1',/*最小日期*/
	'maxDate':'2030-12-31',/*最大日期*/
	'onSubmit':function(){/*确认时触发事件*/
		var theSelectData =calendar2.value;
		$('.date_text').text(theSelectData);
		$('.month_text').text('Month');
    montime='';
    daytime=theSelectData;
    $('.main_box1').html('');
    $('.main_box2').html('');
    creadall();
	},
	'onClose':function(){/*取消时触发事件*/
	}
});

</script>


</html>
